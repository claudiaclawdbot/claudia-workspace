# Codebase Improvements Backlog

**Generated:** 2026-02-04  
**Scope:** Full /Users/clawdbot/clawd review  
**Purpose:** Prioritized list for overnight autonomous work

---

## ðŸš¨ HIGH PRIORITY (Fix First)

### HP1: Consolidate Duplicate Playwright Boilerplate âœ… DONE
**File created:** `/Users/clawdbot/clawd/lib/clawk-browser.js`

**Status:** âœ… **COMPLETE** - 2026-02-04

**Includes:**
- `withBrowser(callback, options)` - Managed browser lifecycle
- `withPage(url, callback, options)` - Navigate + execute pattern
- `safeClose(browser)` - Error-safe cleanup
- `captureScreenshot(page, filename)` - Auto-directory creation
- `waitForElement(page, selector)` - Wait with retry logic
- `typeHumanLike(page, selector, text)` - Human-like typing
- `elementExists(page, selector)` - Boolean check
- `getText(page, selector)` - Safe text extraction
- `scrollToElement(page, selector)` - Smooth scrolling
- `extractLinks(page)` - Get all links
- `loadCookies(context, filepath)` - Session restoration
- `saveCookies(context, filepath)` - Session persistence

**Next Steps:**
- Refactor the 6 clawk-* scripts to use this library
- Each script can be simplified from ~50 lines to ~20 lines

**Commit:** `Add shared Playwright browser automation library (clawk-browser)`

---

### HP2: Standardize Shell Script Header Patterns ðŸ”„ IN PROGRESS
**Files affected:** 20+ shell scripts across `/scripts`, `/tools`, root

**Status:** ðŸ”„ **PARTIALLY COMPLETE** - 5 scripts standardized, ~15 remaining

**Completed:**
- âœ… `scripts/gateway-restart.sh`
- âœ… `scripts/fix-ollama.sh`
- âœ… `scripts/verify-gateway-ollama.sh`
- âœ… `scripts/gateway-full-reset.sh`
- âœ… `tools/quick-stats.sh`

**Template Created:** `templates/script-template.sh`

**Standard Applied:**
```bash
#!/usr/bin/env bash
set -euo pipefail
IFS=$'\n\t'
```

**Remaining:**
- agent-claudia/*.sh
- scripts/clawk-outreach.sh
- scripts/ralph-wiggum-loop.sh
- tools/*.sh
- Root-level scripts

**Effort:** 20 min (10 min remaining)  
**Value:** Consistency, better error handling, follows bash best practices

---

### HP3: Fix TODO_IMPROVEMENTS.md - Incomplete Action Items
**File:** `/Users/clawdbot/clawd/TODO_IMPROVEMENTS.md`

**Issue:** Contains vague action items without owners or completion criteria:
- "Create Automated Check for Name Violations" - no implementation plan
- "Migrate to Full File-Based Redaction" - no script/tool provided
- "Standardize Memory Organization" - no function created
- "Clean all commit name references..." - incomplete

**Fix:** Convert to actionable tickets with:
- Clear acceptance criteria
- Estimated effort
- Specific file paths
- Priority ranking (this doc supersedes it)

**Effort:** 15 min  
**Value:** Clarity on what needs doing

---

### HP4: Remove Hardcoded Credentials from Scripts
**Files affected:**
- `/Users/clawdbot/clawd/scripts/clawk-outreach.sh` - contains API key
- `/Users/clawdbot/clawd/x402-cli.sh` - wallet address hardcoded
- Multiple files reference `/Users/clawdbot/clawd/clawk_credentials_new.json`

**Issue:** API keys and sensitive data in source control

**Fix:** 
1. Move secrets to `.env` file (already exists but underutilized)
2. Update scripts to source `.env`
3. Add `.env` to `.gitignore` (verify it's there)
4. Create `.env.example` template

**Effort:** 25 min  
**Value:** Security, prevents accidental credential leaks

---

## ðŸ”„ MEDIUM PRIORITY (Consolidate & Clean)

### MP1: Create Shared JavaScript Utilities Library âœ… DONE
**File created:** `/Users/clawdbot/clawd/lib/claudia-tools.js`

**Status:** âœ… **COMPLETE** - 2026-02-04

**Includes:**
- **CLI:** parseArgs, showHelp, confirm
- **IO:** readJSON, writeJSON, safeRead, exists, ensureDir
- **FORMAT:** formatCurrency, formatDate, timeAgo, markdownTable
- **LOG:** info, success, warn, error, debug (with colors)
- **CONSTANTS:** CONTACT_EMAIL, GITHUB_URL, PRICES (all tools), DISCOUNTS

**Features:**
- ~350 lines of shared utilities
- JSDoc documentation for all functions
- Color-coded logging
- Safe file operations with defaults
- CLI argument parsing (better than manual)

**Next Steps:**
- Refactor existing tools to use this library
- Add --version flag support to all tools

**Commit:** `Add shared JavaScript utilities library (claudia-tools)`

---

### MP2: Unify Report Generation Pattern
**Files affected:**
- `/Users/clawdbot/clawd/tools/changelog-gen.js`
- `/Users/clawdbot/clawd/tools/standup-reporter.sh`
- `/Users/clawdbot/clawd/tools/repo-analyzer.sh`
- `/Users/clawdbot/clawd/generate-daily-report.sh`
- `/Users/clawdbot/clawd/agent-claudia/daily-github-update.sh`

**Issue:** Multiple report generators with overlapping concerns:
- Git activity tracking (3 different implementations)
- Markdown formatting (inconsistent headers, separators)
- Output handling (some to stdout, some to files)

**Fix:** Create single `claudia-report` CLI tool with subcommands:
```bash
claudia-report git-activity --since yesterday
claudia-report daily --output report.md
claudia-report standup --slack-format
```

**Effort:** 60 min  
**Value:** Single maintainable reporting system

---

### MP3: Consolidate HTML Page Templates
**Files affected:**
- `/Users/clawdbot/clawd/hire-me.html`
- `/Users/clawdbot/clawd/portfolio.html`
- `/Users/clawdbot/clawd/index.html`
- `/Users/clawdbot/clawd/share.html`
- `/Users/clawdbot/clawd/CLAUDIA_HOME.html`

**Issue:** CSS patterns duplicated:
```css
/* Repeated in multiple files */
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: ... }
.container { max-width: 800px; margin: 0 auto; }
```

**Fix:** 
1. Create `assets/style.css` shared stylesheet
2. Use inline `<style>` only for page-specific overrides
3. Or create a base template system

**Effort:** 40 min  
**Value:** Consistent branding, easier theme updates

---

### MP4: Archive or Delete Stale Files
**Files to review:**
- `/Users/clawdbot/clawd/x402-landing-page.html` - Superseded by hire-me.html?
- `/Users/clawdbot/clawd/clawk_draft.txt` - Empty/useless
- `/Users/clawdbot/clawd/test_data.txt` - Contains just "Test data"
- `/Users/clawdbot/clawd/biible-improvements.patch` - 144KB patch file, likely applied
- `/Users/clawdbot/clawd/archive/old-status/*` - Many files, review for relevance

**Fix:** 
1. Move truly obsolete files to `/archive/obsolete/`
2. Delete empty/test files
3. Document why archived files are kept

**Effort:** 30 min  
**Value:** Cleaner workspace, faster grepping

---

### MP5: Fix recursive-prompt.sh Variable Substitution Bug âœ… FIXED
**File:** `/Users/clawdbot/clawd/agent-claudia/recursive-prompt.sh`

**Status:** âœ… **FIXED** - 2026-02-04

**Issue:** Lines 89-93 attempt sed substitution on `/tmp/claudia-prompt.txt` but:
- The file is never created (HEREDOC outputs to stdout, not file)
- `sed -i ''` syntax is macOS-specific (portability issue)
- Variables like `##CYCLE##` are output literally, never replaced

**Fix Applied:**
```bash
# Before: cat << 'PROMPT' (outputs to stdout, file never created)
# After: cat << 'PROMPT' > /tmp/claudia-prompt.txt (writes to file)
```

**Commit:** `Fix recursive-prompt.sh: Add missing file write before sed`

**Also Created:** `/Users/clawdbot/clawd/templates/script-template.sh` - Standardized script header template

---

## ðŸ“š DOCUMENTATION (Quick Wins)

### DOC1: Add README.md to `/tools/` Directory âœ… DONE
**File created:** `/Users/clawdbot/clawd/tools/README.md`

**Status:** âœ… **COMPLETE** - 2026-02-04

**Includes:**
- Complete catalog of all 14 tools with descriptions and pricing
- Usage examples for each tool
- Quick start guide
- Installation instructions
- Troubleshooting section
- License and links

**Commit:** `Add comprehensive README for tools directory`

---

### DOC2: Add README.md to `/scripts/` Directory âœ… DONE
**File created:** `/Users/clawdbot/clawd/scripts/README.md`

**Status:** âœ… **COMPLETE** - 2026-02-04

**Includes:**
- Quick reference table of all 6 scripts
- Detailed usage for each script
- Environment variables documentation
- Troubleshooting section
- Script standards and template info
- Cron integration notes

**Commit:** `Add comprehensive README for scripts directory`

---

### DOC3: Document the Orchestration System
**Files:** `/Users/clawdbot/clawd/orchestration/`, `/Users/clawdbot/clawd/agent-claudia/`

**Issue:** Complex orchestration with multiple components but no architecture doc at the component level

**Fix:** Create `ORCHESTRATION_ARCHITECTURE.md` explaining:
- How checkpoint.sh, orchestrator.json, and recursive-prompt.sh interact
- State management flow
- Autonomous decision-making logic

**Effort:** 30 min  
**Value:** Understanding for debugging, future modifications

---

### DOC4: Add JSDoc to Tool Functions
**Files:** All `/tools/*.js`

**Issue:** Functions lack parameter documentation:
```javascript
function generateJSClient(endpoints) {
  // What shape should endpoints have?
}
```

**Fix:** Add JSDoc comments:
```javascript
/**
 * Generate JavaScript API client
 * @param {Array<{path: string, method: string, description: string}>} endpoints
 * @returns {string} Generated client code
 */
```

**Effort:** 25 min  
**Value:** IDE autocomplete, type checking, self-documenting

---

## ðŸ”§ CODE QUALITY (Refactoring)

### CQ1: Add Error Handling to CLI Tools
**Files:** `/tools/*.js`

**Issue:** Most tools lack proper error handling:
```javascript
const content = fs.readFileSync(filePath, 'utf8'); // Crashes if file missing
```

**Fix:** Add try-catch wrappers and user-friendly error messages:
```javascript
try {
  const content = fs.readFileSync(filePath, 'utf8');
} catch (err) {
  console.error(`Error reading ${filePath}: ${err.message}`);
  process.exit(1);
}
```

**Effort:** 30 min  
**Value:** Better UX when things go wrong

---

### CQ2: Fix Magic Numbers in revenue-tracker.js
**File:** `/Users/clawdbot/clawd/orchestration/revenue-tracker.js`

**Issue:** Hardcoded values scattered throughout:
- Goal amount: `1000000` (line 13)
- Milestone amounts: `[1000, 10000, 50000, ...]`
- Progress bar width: `40`

**Fix:** Create CONFIG object at top:
```javascript
const CONFIG = {
  GOAL_AMOUNT: 1000000,
  PROGRESS_BAR_WIDTH: 40,
  MILESTONES: [1000, 10000, 50000, ...]
};
```

**Effort:** 15 min  
**Value:** Easier configuration changes

---

### CQ3: Consolidate Color Constants
**Files:** Multiple shell scripts

**Issue:** Color definitions repeated:
```bash
# In x402-cli.sh
RED='\033[0;31m'
GREEN='\033[0;32m'

# Could be in other scripts too
```

**Fix:** Source from shared file:
```bash
source "$(dirname "$0")/../lib/colors.sh"
```

**Effort:** 20 min  
**Value:** Consistent terminal output

---

## ðŸš€ FEATURE ADDITIONS (New Capabilities)

### FEAT1: Create Tool Installation Script
**File to create:** `/tools/install.sh`

**Purpose:** One-command installation of all CLI tools:
```bash
./tools/install.sh  # Symlinks all tools to /usr/local/bin
```

**Effort:** 15 min  
**Value:** Easy customer onboarding

---

### FEAT2: Add --version Flag to All Tools
**Files:** All `/tools/*.js`

**Purpose:** Standard CLI convention:
```bash
readme-gen --version  # Output: 1.0.0
```

**Effort:** 10 min  
**Value:** CLI best practice

---

### FEAT3: Create Health Check Dashboard Script
**File to create:** `/scripts/health-dashboard.sh`

**Purpose:** Unified health check that outputs JSON for dashboard consumption:
```bash
./scripts/health-dashboard.sh --json
# Output: {"git_status": "clean", "pending_tasks": 5, ...}
```

**Effort:** 30 min  
**Value:** Feeds into CLAUDIA_HOME.html dashboard

---

## ðŸ“Š STATISTICS

- **Total JS files (excl. node_modules):** 283
- **Total shell scripts:** 81
- **Tools for sale:** 10
- **High priority items:** 4
- **Medium priority items:** 5
- **Documentation items:** 4
- **Code quality items:** 3
- **Feature additions:** 3

**Total estimated effort:** ~8 hours  
**Quick wins (under 30 min):** 10 items

---

## ðŸŽ¯ RECOMMENDED OVERNIGHT WORK ORDER

1. **HP4** - Remove hardcoded credentials (security first)
2. **HP3** - Clean up TODO_IMPROVEMENTS.md
3. **MP5** - Fix recursive-prompt.sh bug
4. **HP1** - Consolidate Playwright boilerplate
5. **MP4** - Archive stale files
6. **DOC1** - Create tools README
7. **CQ2** - Fix magic numbers
8. **FEAT1** - Tool installation script
9. **DOC2** - Scripts README
10. **CQ1** - Add error handling

This order prioritizes security, fixes broken functionality, then improves maintainability.

---

*Generated by autonomous code review session*  
*For questions: Review this file with main agent*
