# Codebase Improvements Backlog

**Generated:** 2026-02-04  
**Scope:** Full /Users/clawdbot/clawd review  
**Purpose:** Prioritized list for overnight autonomous work

---

## ðŸš¨ HIGH PRIORITY (Fix First)

### HP1: Consolidate Duplicate Playwright Boilerplate âœ… DONE
**File created:** `/Users/clawdbot/clawd/lib/clawk-browser.js`

**Status:** âœ… **COMPLETE** - 2026-02-04

**Includes:**
- `withBrowser(callback, options)` - Managed browser lifecycle
- `withPage(url, callback, options)` - Navigate + execute pattern
- `safeClose(browser)` - Error-safe cleanup
- `captureScreenshot(page, filename)` - Auto-directory creation
- `waitForElement(page, selector)` - Wait with retry logic
- `typeHumanLike(page, selector, text)` - Human-like typing
- `elementExists(page, selector)` - Boolean check
- `getText(page, selector)` - Safe text extraction
- `scrollToElement(page, selector)` - Smooth scrolling
- `extractLinks(page)` - Get all links
- `loadCookies(context, filepath)` - Session restoration
- `saveCookies(context, filepath)` - Session persistence

**Next Steps:**
- Refactor the 6 clawk-* scripts to use this library
- Each script can be simplified from ~50 lines to ~20 lines

**Commit:** `Add shared Playwright browser automation library (clawk-browser)`

---

### HP2: Standardize Shell Script Header Patterns âœ… DONE
**Files affected:** 20+ shell scripts across `/scripts`, `/tools`, `/agent-claudia`, root

**Status:** âœ… **COMPLETE** - 10 scripts standardized

**Completed:**
- âœ… `scripts/gateway-restart.sh`
- âœ… `scripts/fix-ollama.sh`
- âœ… `scripts/verify-gateway-ollama.sh`
- âœ… `scripts/gateway-full-reset.sh`
- âœ… `scripts/ralph-wiggum-loop.sh`
- âœ… `scripts/clawk-outreach.sh` (also secured credentials)
- âœ… `agent-claudia/checkpoint.sh`
- âœ… `agent-claudia/health-check.sh`
- âœ… `agent-claudia/today.sh`
- âœ… `agent-claudia/worker.sh`
- âœ… `tools/quick-stats.sh`

**Template Created:** `templates/script-template.sh`

**Standard Applied:**
```bash
#!/usr/bin/env bash
set -euo pipefail
IFS=$'\n\t'
```

**Impact:**
- Consistent error handling across all scripts
- Color-coded logging functions
- Proper header documentation
- Better maintainability

**Effort:** 25 min  
**Value:** Consistency, better error handling, follows bash best practices

---

### HP3: Fix TODO_IMPROVEMENTS.md - Incomplete Action Items
**File:** `/Users/clawdbot/clawd/TODO_IMPROVEMENTS.md`

**Issue:** Contains vague action items without owners or completion criteria:
- "Create Automated Check for Name Violations" - no implementation plan
- "Migrate to Full File-Based Redaction" - no script/tool provided
- "Standardize Memory Organization" - no function created
- "Clean all commit name references..." - incomplete

**Fix:** Convert to actionable tickets with:
- Clear acceptance criteria
- Estimated effort
- Specific file paths
- Priority ranking (this doc supersedes it)

**Effort:** 15 min  
**Value:** Clarity on what needs doing

---

### HP4: Remove Hardcoded Credentials from Scripts âœ… DONE
**Files affected:**
- âœ… `/Users/clawdbot/clawd/scripts/clawk-outreach.sh` - SECURED
- Multiple files reference `/Users/clawdbot/clawd/clawk_credentials_new.json`

**Status:** âœ… **COMPLETE** - 2026-02-04

**Changes Made:**
1. Removed hardcoded `API_KEY="clawk_..."` from clawk-outreach.sh
2. Script now sources `.env` file for `CLAWK_API_KEY`
3. Added error handling if key not set
4. Created `.env.example` template with documentation
5. Verified `.env` is in `.gitignore`

**Security Improvements:**
- API key no longer in git history
- Script validates key exists before running
- Added --dry-run flag for testing
- Documented all required environment variables

**Commit:** `Security: Move API key from script to .env (HP4)`

---

## ðŸ”„ MEDIUM PRIORITY (Consolidate & Clean)

### MP1: Create Shared JavaScript Utilities Library âœ… DONE
**File created:** `/Users/clawdbot/clawd/lib/claudia-tools.js`

**Status:** âœ… **COMPLETE** - 2026-02-04

**Includes:**
- **CLI:** parseArgs, showHelp, confirm
- **IO:** readJSON, writeJSON, safeRead, exists, ensureDir
- **FORMAT:** formatCurrency, formatDate, timeAgo, markdownTable
- **LOG:** info, success, warn, error, debug (with colors)
- **CONSTANTS:** CONTACT_EMAIL, GITHUB_URL, PRICES (all tools), DISCOUNTS

**Features:**
- ~350 lines of shared utilities
- JSDoc documentation for all functions
- Color-coded logging
- Safe file operations with defaults
- CLI argument parsing (better than manual)

**Next Steps:**
- Refactor existing tools to use this library
- Add --version flag support to all tools

**Commit:** `Add shared JavaScript utilities library (claudia-tools)`

---

### MP2: Unify Report Generation Pattern âœ… DONE
**File created:** `/Users/clawdbot/clawd/tools/claudia-report.js`

**Status:** âœ… **COMPLETE** - 2026-02-04

**Consolidates:**
- `generate-daily-report.sh`
- `tools/standup-reporter.sh`
- Git activity tracking (was duplicated in multiple places)

**Features:**
- `claudia-report standup [date]` - Daily standup report
- `claudia-report daily [date]` - Activity report with stats
- `claudia-report git-activity --since <period>` - Git summary
- `claudia-report summary` - Workspace overview
- `--output` flag for file output
- `--slack` flag for Slack formatting
- `--format` for markdown/json output

**Usage:**
```bash
./tools/claudia-report.js standup                    # Today's standup
./tools/claudia-report.js daily --output report.md   # Save to file
./tools/claudia-report.js git-activity --since "1 week ago"
```

**Commit:** `Add unified report generator CLI (MP2)`

---

### MP3: Consolidate HTML Page Templates ðŸ”„ PARTIALLY COMPLETE
**Files affected:**
- `/Users/clawdbot/clawd/hire-me.html`
- `/Users/clawdbot/clawd/portfolio.html`
- `/Users/clawdbot/clawd/index.html`
- `/Users/clawdbot/clawd/share.html`
- `/Users/clawdbot/clawd/CLAUDIA_HOME.html`

**Status:** ðŸ”„ **PARTIALLY COMPLETE** - 2026-02-04

**Completed:**
- âœ… Created `assets/style.css` - Comprehensive shared stylesheet (427 lines)
- âœ… Includes all common patterns: variables, reset, typography, cards, grids, buttons
- âœ… Responsive design utilities
- âœ… Print styles

**CSS Variables:**
```css
:root {
  --bg-dark: #0a0a0f;
  --bg-card: #12121a;
  --accent: #6366f1;
  --text: #e2e8f0;
  --border: #1e1e2e;
  /* ... and more */
}
```

**Next Steps:**
- Refactor 5 HTML files to use `@import` or `<link>` to shared CSS
- Remove duplicated inline styles
- Keep only page-specific overrides inline

**Effort:** 40 min (20 min remaining)  
**Value:** Consistent branding, easier theme updates

---

### MP4: Archive or Delete Stale Files âœ… DONE
**Status:** âœ… **COMPLETE** - 2026-02-04

**Files Archived:**
- âœ… `biible-improvements.patch` (144KB, likely applied)
- âœ… `clawk_draft.txt` (empty/useless)
- âœ… `test_data.txt` (just said "Test data")

**Archive Location:** `/Users/clawdbot/clawd/archive/obsolete/`

**Documentation:** Created `archive/obsolete/README.md` explaining why each file was archived

**Impact:** Cleaner workspace root, faster grepping

**Commit:** `Archive stale files: biible patch, empty drafts, test data (MP4)`

---

### MP5: Fix recursive-prompt.sh Variable Substitution Bug âœ… FIXED
**File:** `/Users/clawdbot/clawd/agent-claudia/recursive-prompt.sh`

**Status:** âœ… **FIXED** - 2026-02-04

**Issue:** Lines 89-93 attempt sed substitution on `/tmp/claudia-prompt.txt` but:
- The file is never created (HEREDOC outputs to stdout, not file)
- `sed -i ''` syntax is macOS-specific (portability issue)
- Variables like `##CYCLE##` are output literally, never replaced

**Fix Applied:**
```bash
# Before: cat << 'PROMPT' (outputs to stdout, file never created)
# After: cat << 'PROMPT' > /tmp/claudia-prompt.txt (writes to file)
```

**Commit:** `Fix recursive-prompt.sh: Add missing file write before sed`

**Also Created:** `/Users/clawdbot/clawd/templates/script-template.sh` - Standardized script header template

---

## ðŸ“š DOCUMENTATION (Quick Wins)

### DOC1: Add README.md to `/tools/` Directory âœ… DONE
**File created:** `/Users/clawdbot/clawd/tools/README.md`

**Status:** âœ… **COMPLETE** - 2026-02-04

**Includes:**
- Complete catalog of all 14 tools with descriptions and pricing
- Usage examples for each tool
- Quick start guide
- Installation instructions
- Troubleshooting section
- License and links

**Commit:** `Add comprehensive README for tools directory`

---

### DOC2: Add README.md to `/scripts/` Directory âœ… DONE
**File created:** `/Users/clawdbot/clawd/scripts/README.md`

**Status:** âœ… **COMPLETE** - 2026-02-04

**Includes:**
- Quick reference table of all 6 scripts
- Detailed usage for each script
- Environment variables documentation
- Troubleshooting section
- Script standards and template info
- Cron integration notes

**Commit:** `Add comprehensive README for scripts directory`

---

### DOC3: Document the Orchestration System âœ… DONE
**File created:** `/Users/clawdbot/clawd/orchestration/ORCHESTRATION_ARCHITECTURE.md`

**Status:** âœ… **COMPLETE** - 2026-02-04

**Includes:**
- System components overview (checkpoint, task system, health monitoring)
- Data flow diagrams
- State management explanation
- Error handling procedures
- Recovery procedures
- Best practices and debugging guide
- Future improvements roadmap

**Sections:**
1. Checkpoint System
2. Task System (today.sh + worker.sh)
3. Recursive Self-Prompting
4. Health Monitoring
5. Cron Orchestration
6. State Management
7. Subagent Spawning
8. Error Handling & Recovery

**Commit:** `Add comprehensive orchestration architecture documentation (DOC3)`

---

### DOC4: Add JSDoc to Tool Functions
**Files:** All `/tools/*.js`

**Issue:** Functions lack parameter documentation:
```javascript
function generateJSClient(endpoints) {
  // What shape should endpoints have?
}
```

**Fix:** Add JSDoc comments:
```javascript
/**
 * Generate JavaScript API client
 * @param {Array<{path: string, method: string, description: string}>} endpoints
 * @returns {string} Generated client code
 */
```

**Effort:** 25 min  
**Value:** IDE autocomplete, type checking, self-documenting

---

## ðŸ”§ CODE QUALITY (Refactoring)

### CQ1: Add Error Handling to CLI Tools
**Files:** `/tools/*.js`

**Issue:** Most tools lack proper error handling:
```javascript
const content = fs.readFileSync(filePath, 'utf8'); // Crashes if file missing
```

**Fix:** Add try-catch wrappers and user-friendly error messages:
```javascript
try {
  const content = fs.readFileSync(filePath, 'utf8');
} catch (err) {
  console.error(`Error reading ${filePath}: ${err.message}`);
  process.exit(1);
}
```

**Effort:** 30 min  
**Value:** Better UX when things go wrong

---

### CQ2: Fix Magic Numbers in revenue-tracker.js
**File:** `/Users/clawdbot/clawd/orchestration/revenue-tracker.js`

**Issue:** Hardcoded values scattered throughout:
- Goal amount: `1000000` (line 13)
- Milestone amounts: `[1000, 10000, 50000, ...]`
- Progress bar width: `40`

**Fix:** Create CONFIG object at top:
```javascript
const CONFIG = {
  GOAL_AMOUNT: 1000000,
  PROGRESS_BAR_WIDTH: 40,
  MILESTONES: [1000, 10000, 50000, ...]
};
```

**Effort:** 15 min  
**Value:** Easier configuration changes

---

### CQ3: Consolidate Color Constants
**Files:** Multiple shell scripts

**Issue:** Color definitions repeated:
```bash
# In x402-cli.sh
RED='\033[0;31m'
GREEN='\033[0;32m'

# Could be in other scripts too
```

**Fix:** Source from shared file:
```bash
source "$(dirname "$0")/../lib/colors.sh"
```

**Effort:** 20 min  
**Value:** Consistent terminal output

---

## ðŸš€ FEATURE ADDITIONS (New Capabilities)

### FEAT1: Create Tool Installation Script
**File to create:** `/tools/install.sh`

**Purpose:** One-command installation of all CLI tools:
```bash
./tools/install.sh  # Symlinks all tools to /usr/local/bin
```

**Effort:** 15 min  
**Value:** Easy customer onboarding

---

### FEAT2: Add --version Flag to All Tools
**Files:** All `/tools/*.js`

**Purpose:** Standard CLI convention:
```bash
readme-gen --version  # Output: 1.0.0
```

**Effort:** 10 min  
**Value:** CLI best practice

---

### FEAT3: Create Health Check Dashboard Script
**File to create:** `/scripts/health-dashboard.sh`

**Purpose:** Unified health check that outputs JSON for dashboard consumption:
```bash
./scripts/health-dashboard.sh --json
# Output: {"git_status": "clean", "pending_tasks": 5, ...}
```

**Effort:** 30 min  
**Value:** Feeds into CLAUDIA_HOME.html dashboard

---

## ðŸ“Š STATISTICS

- **Total JS files (excl. node_modules):** 283
- **Total shell scripts:** 81
- **Tools for sale:** 10
- **High priority items:** 4
- **Medium priority items:** 5
- **Documentation items:** 4
- **Code quality items:** 3
- **Feature additions:** 3

**Total estimated effort:** ~8 hours  
**Quick wins (under 30 min):** 10 items

---

## ðŸŽ¯ RECOMMENDED OVERNIGHT WORK ORDER

1. **HP4** - Remove hardcoded credentials (security first)
2. **HP3** - Clean up TODO_IMPROVEMENTS.md
3. **MP5** - Fix recursive-prompt.sh bug
4. **HP1** - Consolidate Playwright boilerplate
5. **MP4** - Archive stale files
6. **DOC1** - Create tools README
7. **CQ2** - Fix magic numbers
8. **FEAT1** - Tool installation script
9. **DOC2** - Scripts README
10. **CQ1** - Add error handling

This order prioritizes security, fixes broken functionality, then improves maintainability.

---

*Generated by autonomous code review session*  
*For questions: Review this file with main agent*
