# Tool Discovery: qmd

**Date:** 2026-02-04  
**Tool:** `qmd` - Local Search & Indexing CLI  
**Source:** https://github.com/tobi/qmd  
**Skill Location:** `/Users/clawdbot/clawd/skills/qmd/`

---

## What It Does

`qmd` is a powerful local document search and indexing tool that combines three search methods:

1. **BM25** - Classic full-text search (TF-IDF based)
2. **Vector Search** - Semantic similarity using embeddings (800 token chunks, 15% overlap)
3. **Hybrid Query** - Combined search with query expansion + reranking

It maintains a local SQLite index at `~/.cache/qmd/index.sqlite` and can index any collection of files matching a pattern.

### Key Features
- **Collections**: Organize files into named collections (e.g., "workspace", "memory")
- **Multiple output formats**: `--files`, `--json`, `--csv`, `--md`, `--xml`
- **MCP mode**: Can run as an MCP server for AI agent integration (`qmd mcp`)
- **Document retrieval**: Get specific documents or lines with `qmd get`
- **Context management**: Add custom context to paths
- **Local models**: Uses auto-downloaded HuggingFace models (no API keys needed)
  - Embedding: `embeddinggemma-300M-Q8_0`
  - Reranking: `qwen3-reranker-0.6b-q8_0`
  - Generation: `Qwen3-0.6B-Q8_0`

---

## How to Use It

### Indexing

```bash
# Add a collection
qmd collection add /path/to/files --name mydocs --mask "**/*.md"

# List collections
qmd collection list

# Update all indexes
qmd update

# Check status
qmd status
```

### Search

```bash
# Full-text search (BM25)
qmd search "query" -n 5

# Vector semantic search
qmd vsearch "similar concept" -n 5

# Hybrid search (best results)
qmd query "complex query" -n 5

# Filter by collection
qmd search "query" -c workspace

# Output formats
qmd search "query" --files      # docid,score,filepath
qmd search "query" --json       # JSON with snippets
qmd search "query" --md         # Markdown format
```

### Document Retrieval

```bash
# List files in a collection
qmd ls workspace

# Get a specific document
qmd get "qmd://workspace/agents.md" -l 20

# Get multiple documents
qmd multi-get "qmd://workspace/*.md" -l 5
```

### Collection Management

```bash
qmd collection remove <name>
qmd collection rename <old> <new>
```

---

## Current Setup

```
Index: /Users/clawdbot/.cache/qmd/index.sqlite
Size:  3.4 MB

Collections:
  workspace (qmd://workspace/)
    Pattern: **/*.md
    Files: 34

  memory (qmd://memory/)
    Pattern: **/*.md
    Files: 21

Documents: 55 total, 46 embedded
```

---

## Practical Use Cases for Claudia

### 1. Quick Memory Search
Instead of reading all memory files, search for specific topics:
```bash
qmd search "song a day" -c memory -n 3
```

### 2. Find Relevant Context
When starting a task, search for related prior work:
```bash
qmd query "heartbeat implementation" --md
```

### 3. Document Retrieval
Quickly pull up specific files without full path:
```bash
qmd get "qmd://workspace/tools.md" -l 30
```

### 4. Cross-Reference Information
Search across both workspace and memory collections to find connections between current tasks and past sessions.

### 5. MCP Integration
The `qmd mcp` command enables AI agents to query the index directly through the Model Context Protocol.

---

## Limitations and Issues Found

### 1. **First-Time Vector Search is Slow**
- Initial `vsearch` or `query` downloads ~1.28GB of models from HuggingFace
- Download took several minutes on first run
- No progress indication in some terminals (spinner only)

### 2. **No Ollama = No Vectors**
- Vector search requires Ollama running at `OLLAMA_URL` (default: `http://localhost:11434`)
- Without Ollama, vector operations hang or fail silently
- BM25 search works fine without Ollama

### 3. **Query Syntax Limitations**
- Simple keyword search only for BM25
- No advanced query operators (AND, OR, NOT)
- Phrase searching unclear

### 4. **File Path Quirks**
- Must use `qmd://` URLs to reference files
- No direct filesystem path support in `get` command
- Pattern matching in `multi-get` requires exact syntax

### 5. **Index Refresh**
- Must manually run `qmd update` to see new files
- No auto-watch mode for file changes
- `--pull` flag for git pull before update, but limited to git repos

### 6. **Collection Names**
- No spaces or special characters in collection names
- Names must be simple alphanumeric

---

## Recommendations

1. **Pre-download models** - Run `qmd embed -f` once to download models before needed
2. **Start Ollama** - Ensure Ollama is running before using vector features
3. **Use `query` for best results** - The hybrid search gives better results than `search` or `vsearch` alone
4. **Update regularly** - Run `qmd update` after adding new files
5. **Use `--md` or `--json`** - These formats are most useful for AI consumption

---

## Verdict

**Very useful for local knowledge management!** The BM25 search alone is fast and effective. Vector search adds semantic understanding when Ollama is available. The MCP mode makes it easy to integrate with agent workflows.

**Best for:** Finding relevant documents, retrieving specific content, semantic search across notes  
**Not ideal for:** Real-time search (needs index updates), complex query syntax, users without Ollama setup
